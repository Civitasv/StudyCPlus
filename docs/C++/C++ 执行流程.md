1. 预处理：处理所有宏命令
2. 编译器：将源文件编译为汇编语言
3. 汇编器：将汇编语言编译为目标文件，二进制文件
4. 链接器：将目标文件合在一起生成可执行文件或者库文件
可执行文件/库文件

大家好，今天我将介绍 C++ 的执行流程。

【总体】总体来说，开发C++程序时，我们的代码是在一个个文本文件中的，编写完成之后，需要将这些文件传递给编译器和链接器，然后编译器将这些源文件编译为二进制文件即目标文件，链接器将这些目标文件链接最终生成可执行程序、静态库或动态库。

下面我们以具体的C++代码为例对这个流程进行更为详细的介绍。

【项目介绍】这个代码很简单，用于输出 `hello world!`。
1. `#include` 头文件包含预处理命令
2. `#define` 宏定义
3. `int main()` 入口函数
4. `std::cout` 标准库 `<iostream>` 中的打印函数
5. `return 0` 程序结束标志

【编译阶段】上面我们已经提到，代码会首先被传递给编译器，生成目标文件，这个阶段我们可以称为编译阶段。这个阶段还可以细分。

> 编译器在编译时：
>
> 1. -E: preprocess only
> 2. -S: compile only, don't assemble and link
> 3. -c: compile and assemble, don't link

【预处理】第一，预处理器处理所有预处理指令，如
	1. `#include` 命令将头文件中的所有内容直接插入到文本中
	2. `#define`
	3. `#if`
	4. ...
	`g++ -E xx.cc`
【编译】第二，编译器将预处理器得到的结果进行（一个个的）编译，生成汇编程序，关于汇编语言，我以后会出视频专门为大家讲解的；
	`g++ -S xx.cc`
【汇编】第三，汇编器将该汇编程序翻译为最终的目标文件；
	`g++ -c xx.cc`

【链接阶段】编译结束得到目标文件后，链接器发挥作用，将目标文件链接在一起，生成最终的可执行程序。
	`g++ xx.cc`

【多文件】单个文件不太容易看出链接器的作用，下面我们增加一个文件 `hello.cc`，该文件只有一个函数 `hello`，该函数用于打印 `hello world`。然后在 `run.cc` 中调用该函数。
1. 不声明，会出现编译错误，因为编译器认为这个函数不存在，需要在 `run.cc` 中声明该函数，告诉编译器该函数是存在的，不要报错。
2. 这样成功了，因为我们真的有 `hello` 函数的定义，但如果我们修改该函数为一个无定义的函数呢，编译仍然会成功，因为编译器是一个个编译源文件的，它相信我们会在其它源文件中提供该函数的定义，函数定义的查找由链接器完成，链接器在链接目标文件时，遇到函数的调用，会去寻找函数的定义，此时发现并不存在 `hello2` 函数的定义，因此会出现链接错误。

【两类错误】对应编译阶段和链接阶段，C++开发中主要存在两类错误，编译错误和链接错误，其中编译错误往往是语法错误，链接错误往往是因为未提供函数的定义，例如未正确引入依赖库，函数的签名不一致等。

以上是对 C++ 执行流程的简单介绍，关于编译器和链接器的具体工作原理，我以后也会出视频专门为大家讲解，谢谢大家。

【结尾】

github @Civitasv